# [苹果M1为什么比英特尔x86快](https://finance.sina.cn/tech/csj/2020-12-02/detail-iiznctke4367373.d.html?fromtech=1&from=wap)

## 1. M1 不是 CPU 

首先，M1 并不是一个简单的 CPU。正如苹果所解释的那样，它是一个系统级芯片，即一系列芯片都被安置在一个硅片封装中。

M1 容纳了 8 核 CPU、8 核 GPU（部分 MacBook Air 机型为 7 核）、统一内存、SSD 控制器、图像信号处理器、Secure Enclave 等大量模块。这就是我们所说的片上系统 （SoC）。

M1并不只是拥有通用的核心和内存，而是包含了各种各样的专用芯片：

+ 中央处理器 (CPU) - SoC 的 "大脑"。运行操作系统和应用程序的大部分代码。
+ 图形处理单元 (GPU) - 处理与图形相关的任务，如可视化应用程序的用户界面和 2D/3D 游戏。
+ 图像处理单元(ISP)--可用于加快图像处理应用所完成的普通任务。
+ 数字信号处理器（DSP）--处理比CPU更多的数学密集型功能。包括解压音乐文件。
+ 神经处理单元（NPU）--用于高端智能手机，以加速机器学习（AI）任务。这些任务包括语音识别和摄像头处理。
+ 视频编码器/解码器 - 处理视频文件和格式的高能效转换
+ Secure Enclave - 加密、认证和安全。
+ 统一内存--允许CPU、GPU和其他核心快速交换信息。

这就是为什么很多人在M1 mac上进行图像和视频编辑时都看到了速度提升的部分原因。它们执行的许多任务都可以直接在特定的硬件上运行。

## 2. 统一内存和共享内存

共享内存确实很糟糕。原因是CPU和GPU必须轮流访问内存。共享就意味着要争夺数据总线的使用权。

基本上，GPU和CPU不得不轮流使用一个狭窄的管道来做数据交换。

但统一内存则并不是这样的。

在统一内存中，GPU核心和CPU核心可以同时访问内存。因此在这种情况下，共享内存没有开销。

另外CPU和GPU可以互相告知一些内存的位置。以前CPU必须将数据从其主内存的区域复制到GPU使用的区域。

有了统一内存，更像是在说 ："嘿，GPU先生，我有30MB的多边形数据，从内存位置2430开始"。GPU就可以开始使用该内存，而不需要做任何复制。

这意味着，通过使用相同的内存池，M1上的所有特殊的协同处理器都可以彼此快速交换信息，从而可以显著提高性能。

## 3. 设计更快速的CPU的核心思想到底有些什么？

+ 在一个序列中更快地执行更多的指令（增加时钟频率）；
+ 并行执行尽可能多的指令（乱序执行）；

## 4. 为什么AMD和Intel的乱序执行不如M1

我说过的那个大的“暂存器”实际上叫做“重新排序缓冲区”(ROB)，它不包含正常的机器码指令。不是CPU从内存中取出来执行的那些，而是CPU指令集架构（ISA）中的指令。也就是我们所说的x86、ARM、PowerPC等指令。

快速运行的能力取决于于你用微操作填满ROB的速度和数量。你填满的越快，它就越大，你就有更多的机会选择你可以并行执行的指令，从而提高性能。

这就是我们看到的巨大差异。最厉害的英特尔和AMD微处理器有4个解码器，这意味着他们可以解码4条指令并行输出微操作。

但苹果有一个疯狂的 8 解码器。不仅如此，ROB的体积是它的三倍。基本上可以容纳3倍的指令。没有其他主流芯片厂商的CPU里有那么多解码器。

为什么英特尔和 AMD 无法添加更多指令解码器？

对于x86来说，一条指令可以有1-15个字节的长度。在RISC芯片上，指令的大小是固定的。

+ 如果每条指令都有相同的长度，那么将一个字节流分割成指令并行地输入8个不同的解码器就变得简单多了！
+ 但是，在 x86 CPU 上，解码器不知道下一个指令从哪儿开始的。它必须实际分析每个指令，才能看到它有多长。

英特尔和AMD采用“粗暴”的方式来处理这个问题，首先它会简单地尝试在每一个可能的起点对指令进行解码。这意味着我们必须处理大量的错误猜测和错误，而这些猜测和错误必须被丢弃。

这就造成了一个错综复杂的解码器阶段，以至于很难再增加更多的解码器。但对于苹果来说，不断增加更多的解码器是很简单的。

事实上增加更多的数量会导致很多其他问题，按照AMD自己的说法，4个解码器基本上是他们能做到的上限。

这也是M1 Firestorm核心在同样的时钟频率下，处理的指令数量基本上是AMD和Intel CPU两倍的原因。

## 5. 为什么苹果不增加时钟频率？

因为更高的时钟频率会使芯片更热。这是苹果的关键卖点之一。与英特尔和AMD的产品不同，他们的电脑几乎不需要风扇。

